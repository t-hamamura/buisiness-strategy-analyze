#!/usr/bin/env python
"""
PDFãƒ™ãƒ¼ã‚¹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
"""
import json
from pathlib import Path

class PDFBasedPromptCreator:
    def __init__(self):
        self.prompts_base = Path('prompts')
        self.load_prompts_data()
        
    def load_prompts_data(self):
        """PDFã‹ã‚‰æŠ½å‡ºã—ãŸå…¨36ãƒ†ãƒ¼ãƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿"""
        try:
            with open('prompts_data.json', 'r', encoding='utf-8') as f:
                self.prompts_data = json.load(f)
        except FileNotFoundError:
            print("âŒ prompts_data.json ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
            print("ğŸ’¡ extract_pdf_prompts.py ã‚’å…ˆã«å®Ÿè¡Œã—ã¦ãã ã•ã„")
            return
        
        print(f"âœ… {len(self.prompts_data)} ãƒ•ã‚§ãƒ¼ã‚ºã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ")
    
    def create_prompt_files(self):
        """å…¨36ãƒ†ãƒ¼ãƒï¼ˆA, B, 1-35, Zï¼‰ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ"""
        print("PDFãƒ™ãƒ¼ã‚¹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã‚’é–‹å§‹...")
        
        # ãƒ•ã‚§ãƒ¼ã‚ºã”ã¨ã«å‡¦ç†
        phase_mapping = {
            'phase_1': ['A', 'B'],
            'phase_2': ['1', '2', '3', '4'],
            'phase_3': ['5', '6', '7'],
            'phase_4': ['8', '9', '10', '11', '12'],
            'phase_5': ['13', '14', '15'],
            'phase_6': ['16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26'],
            'phase_7': ['27', '28', '29', '30', '31', '32'],
            'phase_8': ['33', '34', '35'],
            'final_phase': ['Z']
        }
        
        total_files = 0
        
        for phase_name, theme_ids in phase_mapping.items():
            if phase_name not in self.prompts_data:
                print(f"âš ï¸  {phase_name} ã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
                continue
                
            phase_dir = self.prompts_base / phase_name
            phase_dir.mkdir(parents=True, exist_ok=True)
            
            print(f"\nğŸ“ {self.get_phase_name_jp(phase_name)} ã‚’å‡¦ç†ä¸­...")
            
            for theme_id in theme_ids:
                if theme_id in self.prompts_data[phase_name]:
                    theme_data = self.prompts_data[phase_name][theme_id]
                    files_created = self.create_theme_prompts(phase_name, theme_id, theme_data)
                    total_files += files_created
                else:
                    print(f"  âš ï¸  ãƒ†ãƒ¼ãƒ {theme_id} ã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
        
        print(f"\nâœ… åˆè¨ˆ {total_files} å€‹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã—ãŸ")
    
    def create_theme_prompts(self, phase_name, theme_id, theme_data):
        """å„ãƒ†ãƒ¼ãƒã®3ã‚¹ãƒ†ãƒƒãƒ—åˆ†ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆ"""
        files_created = 0
        
        for step_num in ['1', '2', '3']:
            if step_num in theme_data.get('steps', {}):
                prompt_file = self.prompts_base / phase_name / f"{theme_id}_step{step_num}.md"
                content = self.generate_prompt_content(phase_name, theme_id, theme_data, step_num)
                
                with open(prompt_file, 'w', encoding='utf-8') as f:
                    f.write(content)
                
                print(f"  âœ“ {phase_name}/{theme_id}_step{step_num}.md ã‚’ç”Ÿæˆ")
                files_created += 1
        
        return files_created
    
    def generate_prompt_content(self, phase_name, theme_id, theme_data, step_num):
        """PDFã®å†…å®¹ã«åŸºã¥ã„ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆ"""
        step_data = theme_data['steps'][step_num]
        
        if step_num == '1':
            # ã‚¹ãƒ†ãƒƒãƒ—1ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
            content = f"""# å‘½ä»¤æ›¸ï¼š{self.get_phase_name_jp(phase_name)} - {theme_data['name']} - ã‚¹ãƒ†ãƒƒãƒ—1ï¼š{step_data['title']}

ã‚ãªãŸã¯ã€{step_data.get('role', 'å°‚é–€ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ')}ã§ã™ã€‚

## ä¸»è¦ãªå•ã„
{theme_data['main_question']}

## èƒŒæ™¯ã¨ç›®çš„
{theme_data['description']}

## èª¿æŸ»æŒ‡ç¤º
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã‚ã‚‹{' / '.join(theme_data.get('variables', ['[è‡ªç¤¾å]']))}ã«ã¤ã„ã¦ã€ä»¥ä¸‹ã®è¦³ç‚¹ã‹ã‚‰å¾¹åº•çš„ãªåˆ†æã‚’è¡Œã£ã¦ãã ã•ã„ï¼š

### 1. ç¾çŠ¶ã®è©³ç´°æŠŠæ¡
- å®šé‡çš„ãƒ»å®šæ€§çš„ãƒ‡ãƒ¼ã‚¿ã®åé›†ã¨åˆ†æ
- æ¥­ç•Œæ¨™æº–ã‚„ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¨ã®æ¯”è¼ƒ
- å¼·ã¿ã¨å¼±ã¿ã®æ˜ç¢ºãªç‰¹å®š

### 2. ãƒ‡ãƒ¼ã‚¿åé›†ã¨åˆ†æ
- æœ€æ–°ã®å¸‚å ´ãƒ‡ãƒ¼ã‚¿ã‚„çµ±è¨ˆæƒ…å ±ï¼ˆ2024-2025å¹´ã®ãƒ‡ãƒ¼ã‚¿ã‚’å„ªå…ˆï¼‰
- é–¢é€£ã™ã‚‹æˆåŠŸäº‹ä¾‹ã¨å¤±æ•—äº‹ä¾‹ã®åé›†
- ä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã‹ã‚‰ã®å¼•ç”¨ï¼ˆæœ€ä½10ä»¶ä»¥ä¸Šï¼‰

### 3. èª²é¡Œã¨æ©Ÿä¼šã®ç‰¹å®š
- ç¾çŠ¶ã®å•é¡Œç‚¹ã‚„æ”¹å–„ä½™åœ°ã®æ˜ç¢ºåŒ–
- æ½œåœ¨çš„ãªãƒªã‚¹ã‚¯ã¨æ©Ÿä¼šã®æ´—ã„å‡ºã—
- ç«¶åˆä»–ç¤¾ã¨ã®å·®ç•°åˆ†æ

## å¿…é ˆæˆæœç‰©
"""
            # æˆæœç‰©ãƒªã‚¹ãƒˆã‚’è¿½åŠ 
            for deliverable in theme_data.get('deliverables', []):
                content += f"- {deliverable}\n"
            
            content += """
## æ³¨æ„äº‹é …
- å¿…ãšWebæ¤œç´¢ã‚’ç©æ¥µçš„ã«æ´»ç”¨ã—ã€æœ€æ–°æƒ…å ±ã‚’å«ã‚ã¦ãã ã•ã„
- å…·ä½“çš„ãªæ•°å€¤ãƒ‡ãƒ¼ã‚¿ã¨å‡ºå…¸ã‚’æ˜è¨˜ã—ã¦ãã ã•ã„
- å›³è¡¨ã‚„è¦–è¦šçš„ãªè¡¨ç¾ã‚’æ´»ç”¨ã—ã¦ãã ã•ã„
- åˆ†æçµæœã¯å®¢è¦³çš„ã§æ ¹æ‹ ã®ã‚ã‚‹å†…å®¹ã«ã—ã¦ãã ã•ã„
"""
        
        elif step_num == '2':
            # ã‚¹ãƒ†ãƒƒãƒ—2ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆå‰ã‚¹ãƒ†ãƒƒãƒ—å‚ç…§ï¼‰
            content = f"""# å‘½ä»¤æ›¸ï¼š{self.get_phase_name_jp(phase_name)} - {theme_data['name']} - ã‚¹ãƒ†ãƒƒãƒ—2ï¼š{step_data['title']}

## å‚ç…§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
### â–¼â–¼â–¼ ä»¥ä¸‹ã«ã€ã‚¹ãƒ†ãƒƒãƒ—1ã§ç”Ÿæˆã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆã‚’ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ â–¼â–¼â–¼

### â–²â–²â–² ã‚¹ãƒ†ãƒƒãƒ—1ã®ãƒ¬ãƒãƒ¼ãƒˆã“ã“ã¾ã§ â–²â–²â–²

## å‰ææ¡ä»¶
ã‚¹ãƒ†ãƒƒãƒ—1ã®åˆ†æçµæœã‚’è¸ã¾ãˆã¦ã€æˆ¦ç•¥çš„ãªæè¨€ã‚’è¡Œã„ã¾ã™ã€‚

## æˆ¦ç•¥ç«‹æ¡ˆã®æŒ‡ç¤º
1. **æˆ¦ç•¥ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ¤œè¨**
   - æœ€ä½3ã¤ã®æˆ¦ç•¥æ¡ˆã‚’æç¤º
   - å„æ¡ˆã®ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆãƒ»å®Ÿç¾å¯èƒ½æ€§ã‚’è©•ä¾¡
   - æŠ•è³‡å¯¾åŠ¹æœï¼ˆROIï¼‰ã®è¦‹è¾¼ã¿

2. **æ¨å¥¨æˆ¦ç•¥ã®é¸å®š**
   - æœ€ã‚‚åŠ¹æœçš„ãªæˆ¦ç•¥ã®é¸å®šã¨æ ¹æ‹ 
   - æœŸå¾…ã•ã‚Œã‚‹æˆæœã¨é”æˆæ™‚æœŸ
   - å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã¨å‰ææ¡ä»¶

3. **ãƒªã‚¹ã‚¯è©•ä¾¡**
   - å®Ÿæ–½ä¸Šã®ãƒªã‚¹ã‚¯ã¨å¯¾ç­–
   - ä»£æ›¿æ¡ˆã®æ¤œè¨
   - æˆåŠŸç¢ºç‡ã®è©•ä¾¡

## å¿…é ˆæˆæœç‰©
"""
            # æˆæœç‰©ãƒªã‚¹ãƒˆã‚’è¿½åŠ ï¼ˆã‚¹ãƒ†ãƒƒãƒ—2ç”¨ã«èª¿æ•´ï¼‰
            for deliverable in theme_data.get('deliverables', []):
                if 'æˆ¦ç•¥' in deliverable or 'ãƒ—ãƒ©ãƒ³' in deliverable or 'æ¡ˆ' in deliverable:
                    content += f"- {deliverable}\n"
            
            content += """
## æ³¨æ„äº‹é …
- ã‚¹ãƒ†ãƒƒãƒ—1ã®åˆ†æçµæœã‚’åŸºã«ã€å…·ä½“çš„ã§å®Ÿè¡Œå¯èƒ½ãªæˆ¦ç•¥ã‚’ææ¡ˆã—ã¦ãã ã•ã„
- å®šé‡çš„ãªæ ¹æ‹ ã¨äºˆæ¸¬ã‚’å«ã‚ã¦ãã ã•ã„
- å„ªå…ˆé †ä½ã‚’æ˜ç¢ºã«ã—ã¦ãã ã•ã„
"""
        
        else:  # step_num == '3'
            # ã‚¹ãƒ†ãƒƒãƒ—3ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
            content = f"""# å‘½ä»¤æ›¸ï¼š{self.get_phase_name_jp(phase_name)} - {theme_data['name']} - ã‚¹ãƒ†ãƒƒãƒ—3ï¼š{step_data['title']}

## å‚ç…§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
### â–¼â–¼â–¼ ä»¥ä¸‹ã«ã€ã‚¹ãƒ†ãƒƒãƒ—2ã§ç”Ÿæˆã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆã‚’ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ â–¼â–¼â–¼

### â–²â–²â–² ã‚¹ãƒ†ãƒƒãƒ—2ã®ãƒ¬ãƒãƒ¼ãƒˆã“ã“ã¾ã§ â–²â–²â–²

## å®Ÿè¡Œè¨ˆç”»ã®ç­–å®šæŒ‡ç¤º
é¸å®šã•ã‚ŒãŸæˆ¦ç•¥ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®å…·ä½“çš„ãªè¨ˆç”»ã‚’ç«‹æ¡ˆã—ã¦ãã ã•ã„ï¼š

1. **ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**
   - å…·ä½“çš„ãªã‚¿ã‚¹ã‚¯ã¨ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
   - è²¬ä»»è€…ã¨å®Ÿè¡Œãƒãƒ¼ãƒ 
   - ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã¨ãƒ‡ãƒƒãƒ‰ãƒ©ã‚¤ãƒ³

2. **å¿…è¦ãƒªã‚½ãƒ¼ã‚¹**
   - äººæï¼ˆã‚¹ã‚­ãƒ«è¦ä»¶ã€äººæ•°ï¼‰
   - äºˆç®—ï¼ˆåˆæœŸæŠ•è³‡ã€é‹ç”¨ã‚³ã‚¹ãƒˆï¼‰
   - ãƒ„ãƒ¼ãƒ«ã‚„ã‚·ã‚¹ãƒ†ãƒ 

3. **æˆåŠŸæŒ‡æ¨™ï¼ˆKPIï¼‰**
   - æ¸¬å®šå¯èƒ½ãªç›®æ¨™å€¤
   - ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°æ–¹æ³•ã¨é »åº¦
   - è©•ä¾¡åŸºæº–ã¨ä¿®æ­£ãƒˆãƒªã‚¬ãƒ¼

4. **å®Ÿè£…ä¸Šã®æ³¨æ„ç‚¹**
   - æƒ³å®šã•ã‚Œã‚‹éšœå®³ã¨å¯¾ç­–
   - ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ã¨ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç”»
   - å¤‰æ›´ç®¡ç†ãƒ—ãƒ­ã‚»ã‚¹

## å¿…é ˆæˆæœç‰©
"""
            # æˆæœç‰©ãƒªã‚¹ãƒˆã‚’è¿½åŠ ï¼ˆã‚¹ãƒ†ãƒƒãƒ—3ç”¨ã«èª¿æ•´ï¼‰
            for deliverable in theme_data.get('deliverables', []):
                if 'å®Ÿè¡Œ' in deliverable or 'è¨ˆç”»' in deliverable or 'ã‚¢ã‚¯ã‚·ãƒ§ãƒ³' in deliverable:
                    content += f"- {deliverable}\n"
            
            content += """
## æ³¨æ„äº‹é …
- å…·ä½“çš„ã§æ¸¬å®šå¯èƒ½ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³ã‚’ä½œæˆã—ã¦ãã ã•ã„
- å®Ÿç¾å¯èƒ½æ€§ã‚’é‡è¦–ã—ã¦ãã ã•ã„
- ãƒªã‚¹ã‚¯ã¨å¯¾ç­–ã‚’æ˜ç¢ºã«ã—ã¦ãã ã•ã„
"""
        
        return content
    
    def get_phase_name_jp(self, phase_name):
        """ãƒ•ã‚§ãƒ¼ã‚ºåã®æ—¥æœ¬èªå¤‰æ›"""
        phase_names = {
            'phase_1': 'ãƒ•ã‚§ãƒ¼ã‚ºâ… ï¼šå†…éƒ¨ç’°å¢ƒåˆ†æã¨äº‹æ¥­ãƒ¢ãƒ‡ãƒ«è©•ä¾¡',
            'phase_2': 'ãƒ•ã‚§ãƒ¼ã‚ºâ…¡ï¼šå¤–éƒ¨ç’°å¢ƒåˆ†æã¨äº‹æ¥­æ©Ÿä¼šã®ç‰¹å®š',
            'phase_3': 'ãƒ•ã‚§ãƒ¼ã‚ºâ…¢ï¼šã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¡§å®¢ã¨ã‚¤ãƒ³ã‚µã‚¤ãƒˆã®è§£æ˜',
            'phase_4': 'ãƒ•ã‚§ãƒ¼ã‚ºâ…£ï¼šæä¾›ä¾¡å€¤ã¨å¸‚å ´æŠ•å…¥ï¼ˆGTMï¼‰æˆ¦ç•¥',
            'phase_5': 'ãƒ•ã‚§ãƒ¼ã‚ºâ…¤ï¼šã‚°ãƒ­ãƒ¼ã‚¹æˆ¦ç•¥ã¨åç›Šæ€§åˆ†æ',
            'phase_6': 'ãƒ•ã‚§ãƒ¼ã‚ºâ…¥ï¼šãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ãƒ»ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥',
            'phase_7': 'ãƒ•ã‚§ãƒ¼ã‚ºâ…¦ï¼šæˆ¦ç•¥å®Ÿè¡Œã‚’æ”¯ãˆã‚‹çµ„ç¹”ã¨åŸºç›¤',
            'phase_8': 'ãƒ•ã‚§ãƒ¼ã‚ºâ…§ï¼šæŒç¶šå¯èƒ½æ€§ã¨ãƒªã‚¹ã‚¯ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ',
            'final_phase': 'æœ€çµ‚ãƒ•ã‚§ãƒ¼ã‚ºï¼šå…¨ä½“æˆ¦ç•¥ã®çµ±åˆã¨æè¨€'
        }
        return phase_names.get(phase_name, phase_name)

def main():
    """ãƒ¡ã‚¤ãƒ³å‡¦ç†"""
    print("PDFãƒ™ãƒ¼ã‚¹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã‚’é–‹å§‹ã—ã¾ã™...")
    
    creator = PDFBasedPromptCreator()
    creator.create_prompt_files()
    
    print("\nğŸ‰ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼")
    print("ğŸ“ ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ prompts/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™")

if __name__ == "__main__":
    main() 